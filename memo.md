## 演示内容

### 一、程序实验目标说明
1. **基础实验**：
   - 正常的机器人如何寻路（基于 A* 算法）。
2. **RAG（Retrieval-Augmented Generation）机器人构建**：
   - RAG 机器人是如何设计和组装的。
   - RAG 的工作机制与触发方式。
3. **模拟系统介绍**：
   - 模拟方法与运行逻辑。
   - 餐厅布局区域的定义及可自定义功能。

### 二、实验数据部分
- **当前数据**：
  - 基础订单信息、路径数据、机器人状态等。
- **可扩展数据**：
  - 客流密度、热点区域、时间分布等分析维度。
  - 为未来可能的实验预留字段与数据格式。

### 三、App 技术栈
- 使用技术：`Plotly + Streamlit`
- 编程语言：`Python`
- 实现功能：模拟控制、参数配置、结果可视化、布局编辑等。

---

## 当前存在问题

1. **RAG 模块重构**：
   - 明确三个处理层次：
     - **触发层**：RAG 触发逻辑，是提前规划阶段介入，还是事件中介入？
     - **思考层**：结合知识库推理与选择。
     - **决策层**：将推理结果转化为实际动作。
   - 实现后可测试并比较非 RAG 与 RAG 机器人的决策差异。

---

## 模块说明与可扩展点

### `app/main.py`（UI 层）
- 页面渲染、状态管理、交互处理。
- **扩展点**：
  - 新 Tab 与控制组件。
  - 自定义渲染逻辑与事件分发。

### `SimulationEngine`（app/simulation.py）
- 模拟核心逻辑，生成订单与调度。
- **扩展点**：
  - 多机器人并发与动态调度策略。

### `OrderManager` & `Order`（robot/order.py）
- 管理订单生命周期。
- **扩展点**：
  - 支持优先级与放弃策略。
  - 批量订单支持。

### `PathPlanner`（robot/plan.py）
- A* 寻路算法。
- **扩展点**：
  - 插拔式路径规划（支持 Dijkstra、遗传算法等）。
  - 动态障碍响应。

### `Robot` / `AIEnhancedRobot`（robot/robot.py）
- 封装机器人行为逻辑与智能接口。
- **扩展点**：
  - 加入避障、电池管理等。

### `MotionController`（robot/motion_controller.py）
- 单步移动与障碍处理。
- **扩展点**：
  - 支持不同底盘与真实物理模拟。

### `RAGModule`（robot/rag/）
- RAG 核心模块。
- **扩展点**：
  - 替换向量检索或模型（FAISS、私有LLM）。
  - 自定义 Prompt 模板与知识库结构。

### `RestaurantLayout` & `Restaurant`（restaurant/）
- 加载 JSON 布局并生成网格地图。
- **扩展点**：
  - 支持动态元素、布局设计器开发（CLI/GUI）。

### 可视化模块（visualization/, app/ui.py）
- 动态轨迹、路径、统计图表。
- **扩展点**：
  - 支持 3D 渲染、WebGL。
  - 新分析指标（如路径热力图）。

### 状态管理（app/state.py）
- 封装 Session State，保持用户上下文一致性。
- **扩展点**：
  - 增加缓存与多用户支持。

---

## 系统流程图（Flowchart）

```
mermaid
flowchart TD
  subgraph 用户界面
    A1["启动应用"]
    A2["初始化页面和会话状态"]
    A3["显示餐厅布局选择"]
    A4["加载并显示所选布局"]
    A5["展示参数控件（是否启用智能模式、订单数量）"]
    A6["点击开始模拟"]
    A7["布局编辑与保存/删除"]
  end

  A1 --> A2 --> A3 --> A4 --> A5 --> A6
  A2 --> A7

  subgraph 模拟核心
    B1["启动模拟并生成订单"]
    B2["管理订单生命周期"]
    B3["判断是否启用智能模式"]
    B4["执行普通配送流程"]
    B5["执行智能配送流程"]
    B6["计算最优配送路径"]
    B7["一步移动并处理障碍"]
    B8["更新订单状态"]
    B9["收集统计数据与路径记录"]
  end

  A6 --> B1
  B1 --> B2 --> B3
  B3 -- 否 --> B4
  B3 -- 是 --> B5
  B4 --> B6
  B5 --> B6
  B6 --> B7 --> B8 --> B9
  B9 --> A1

  subgraph 智能决策子系统
    C1["检索增强决策模块"]
    C2["向量检索组件"]
    C3["知识库管理"]
    C4["提示模板处理"]
    C5["语言模型交互"]
  end

  B5 --> C1
  C1 --> C2 --> C3
  C1 --> C4
  C1 --> C5

  subgraph 可视化与分析
    D1["可视化餐厅布局"]
    D2["可视化配送路径"]
    D3["展示基础统计"]
    D4["绘制统计图表"]
    D5["扩展深度分析"]
  end

  B9 --> D1
  B9 --> D2
  B9 --> D3
  B9 --> D4
  B9 --> D5
```
