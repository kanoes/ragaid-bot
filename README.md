# RAGロボットシミュレーションプロジェクト

このプロジェクトはオブジェクト指向設計手法を使用して、レストラン環境における2種類のロボットの経路計画とナビゲーションをシミュレーションします：
1. 基本ロボット：基本的な経路計画機能を持ち、障害物に遭遇すると停止します
2. スマートロボット：OpenAI APIとベクトルデータベースを使用した検索拡張生成技術を実装し、障害物に遭遇した際に意思決定と経路再計画ができます

## プロジェクト構造

```
project/
├── main.py                 # メインプログラム（シミュレーション実行ロジックを含む）
├── .env                    # 環境変数設定ファイル
├── modules/                # モジュール化されたプロジェクト構造
│   ├── robot/              # ロボットモジュール
│   │   ├── __init__.py     
│   │   └── robot.py        # ロボット共通実装（パラメータによってRAGを有効化可能）
│   ├── environment/        # 環境モジュール
│   │   ├── __init__.py
│   │   ├── restaurant_grid.py    # レストラン環境グリッドシミュレーション
│   │   └── restaurant_layout.py  # 20テーブルのレストランレイアウト作成
│   ├── utils/              # ユーティリティモジュール
│   │   ├── __init__.py
│   │   ├── path_planner.py       # A*経路計画アルゴリズム
│   │   ├── order.py              # 注文システム
│   │   └── visualization.py      # 可視化モジュール（軌跡アニメーション）
│   └── rag/                # RAGモジュール
│       ├── __init__.py
│       ├── rag_assistant.py      # RAGアシスタント実装
│       └── knowledge/            # 知識ベースディレクトリ
│           └── knowledge.json    # 知識ベースファイル
└── README.md               # プロジェクト説明ドキュメント
```

## 機能特徴

- **レストラン環境シミュレーション**：
  - 20x20グリッドでレストラン空間を表現
  - 20テーブルあり、各テーブルで注文可能
  - バックキッチンエリアで注文準備
  - 障害物と壁をサポート

- **注文システム**：
  - ユーザーが新しい注文を入力可能（テーブル番号+準備時間）
  - 注文状態追跡（待機中、準備中、準備完了、配送中、配達済み）
  - キッチンシミュレーション（複数の注文を同時処理）

- **ロボットシミュレーション**：
  - 基本ロボット：障害物に遭遇すると停止して失敗
  - スマートロボット：OpenAI APIとベクトルデータベースを使用した検索拡張生成技術を実装し、障害物に遭遇した際に意思決定と代替経路探索が可能

- **比較分析**：
  - 異なるロボットの配送効率の比較
  - 成功率、配送時間などの指標の統計
  - 経路アニメーションの可視化

## RAGロボットの特徴

スマートロボットはOpenAI APIとベクトルデータベースを使用して検索拡張生成技術を実装しています：

1. **知識ベース管理**：
   - JSONファイルからの知識ロードをサポート
   - 新しい知識の動的追加をサポート
   - FAISS ベクトルデータベースを使用した効率的な検索

2. **意思決定プロセス**：
   - 現在の状況をクエリに変換
   - 関連知識の検索
   - LLMを使用した最適な意思決定の生成

3. **設定オプション**：
   - APIキー、モデル、パラメータのカスタマイズ可能
   - 環境変数ファイル(.env)のサポート
   - エラー処理とフォールバックメカニズム

## 依存関係のインストール

基本的な依存関係：
```
pip install matplotlib python-dotenv
```

RAGロボットを使用するための追加インストール：
```
pip install openai faiss-cpu numpy
```

## 実行方法

### 基本実行
```
python main.py
```

### RAGロボットを使用してAPIキーを指定
```
python main.py --api-key YOUR_OPENAI_API_KEY
```

### 知識ベースファイルを指定
```
python main.py --knowledge path/to/knowledge.json
```

## カスタム知識ベースの作成

1. サンプル知識ベースを新しいファイルにコピー
2. そのファイルを編集し、知識エントリを追加します。ファイル形式はJSON配列で、各要素はロボットが理解すべき1つの知識を記述した文字列です

## RAGロボットの設定

プロジェクトは.envファイルを使用して設定を保存します。デフォルトでは、システムは以下の設定を含む.envファイルを自動的に作成します：

```
# OpenAI API設定
OPENAI_API_KEY=your_api_key_here
# モデル設定
EMBEDDING_MODEL=text-embedding-ada-002
COMPLETION_MODEL=gpt-3.5-turbo
TEMPERATURE=0.3
TOP_K=3
```

このファイルを編集して設定をカスタマイズできます：

- `OPENAI_API_KEY`: あなたのOpenAI APIキー
- `EMBEDDING_MODEL`: 埋め込み生成に使用するモデル名
- `COMPLETION_MODEL`: 意思決定生成に使用するモデル名
- `TEMPERATURE`: モデル出力のランダム性（0-1）
- `TOP_K`: 検索時に返される最も関連性の高い知識エントリの数

## 注文入力例

```
注文> 5 10    # テーブル番号5、準備時間10秒
注文> 12 15   # テーブル番号12、準備時間15秒
注文> 完了    # 入力完了
```

## 依存項目

- Python 3.6+
- matplotlib
- python-dotenv
- threading
- OpenAI API（スマートロボット用）
- FAISS（スマートロボット用）
- numpy（スマートロボット用）

## 拡張方法

- 知識ベースにより多くの処理シナリオを追加
- より複雑なレストランレイアウトの追加
- より多くのタイプのロボットアルゴリズムの追加
- 複数ロボットの協調配送の実装
- より多くのコンテキスト情報を使用するRAGシステムの拡張

-test for first push